ChIP.peaks <- read.table("./ENCFF641KGL.bed")
Lung.CREs <- read.table("./ENCFF641KGL.bed")
Lung.CREs
library(stringr)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
library(TFCookbook)
load("ZFP3.RData")
Model_Sample1 %>%
TFCookbook::getEnergyMatrix() %>%
TFCookbook::plotEnergyLogo() + ggtitle("Motif of ZFP3\nSample #1") + theme(plot.title = element_text(hjust = 0.5))
Sample1.processed %>%
filter(Mismatch<=2) %>%
dplyr::rename(Energy=`Relative Energy`) %>%
TFCookbook::buildEnergyModel() -> Model_Sample1
summary(Model_Sample1)
Model_Sample1 %>%
TFCookbook::getEnergyMatrix() %>%
TFCookbook::plotEnergyLogo() + ggtitle("Motif of ZFP3\nSample #1") + theme(plot.title = element_text(hjust = 0.5))
Lung.CREs.GRanges <- GenomicRanges::GRanges(seqnames = Lung.CREs$V1,
ranges   = IRanges(start = Lung.CREs$V2, end = Lung.CREs$V3))
require(BSgenome.Hsapiens.UCSC.hg38)
hg38 <- BSgenome.Hsapiens.UCSC.hg38::BSgenome.Hsapiens.UCSC.hg38
Lung.CREs.GRanges <- GenomicRanges::GRanges(seqnames = Lung.CREs$V1,
ranges   = IRanges(start = Lung.CREs$V2, end = Lung.CREs$V3))
ZFP3.PEM <- Model_Sample1 %>%
TFCookbook::getEnergyMatrix()
ZFP3.sites <- (motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = Lung.CREs.GRanges,
genome = "hg38",
out = "positions",
p.cutoff = 1e-5))[[1]]
ZFP3.sites
require(ChIPpeakAnno)
require(EnsDb.Hsapiens.v86) ##(hg19)
## create annotation file from EnsDb or TxDb
annoData <- toGRanges(EnsDb.Hsapiens.v86, feature="gene")
annotatedPeak <- annotatePeakInBatch(ZFP3.sites,
AnnotationData = annoData)
annotatedPeak$gene_name <- annoData$gene_name[match(annotatedPeak$feature,
names(annoData))]
annotatedPeak %>% as.data.frame() %>%
arrange(desc(score))
#Importing chainfile from USSC repository
chain <- rtracklayer::import.chain("hg38ToMm10.over.chain")
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist()
annotatedPeak.mm10 %>% as_tibble() %>%
arrange(desc(score))
annotatedPeak %>% as.data.frame() %>%
arrange(desc(score)) %>%
dplyr::filter(gene_name == "MARK1")
annotatedPeak.mm10 %>% as_tibble() %>%
arrange(desc(score)) %>%
filter(gene_name == "MARK1")
annotatedPeak.mm10 %>% as_tibble() %>%
arrange(desc(score)) %>%
dplyr::filter(gene_name == "MARK1")
annotatedPeak.mm10 %>% as_tibble() %>%
arrange(desc(score))
annotatedPeak %>% as.data.frame() %>%
arrange(desc(score))
annotatedPeak.mm10 %>% as_tibble()
annotatedPeak %>% as.data.frame()
annotatedPeak.mm10 %>%
as_tibble() %>%
dplyr::filter(width == 28)
annotatedPeak.mm10 %>%
as_tibble() %>%
dplyr::filter(width == 28) %>%
arrange(desc(score))
annotatedPeak %>%
BSgenome::getSeq(BSgenome.Hsapiens.UCSC.hg38,
names = .)
annotatedPeak.mm10 %>% subset(length == 28)
annotatedPeak.mm10
annotatedPeak.mm10 %>% as_tibble()
annotatedPeak.mm10 %>%
subset(width == 28)
BiocManager::install("BSgenome.Mmusculus.UCSC.mm10")
require(BSgenome.Mmusculus.UCSC.mm10)
annotatedPeak.mm10 %>%
subset(width == 28) %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .)
annotatedPeak.mm10 %>%
subset(width == 28) %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .) -> temp
temp@pool
temp %>% as.character()
annotatedPeak.mm10 %>%
subset(width == 28) %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .) %>%
as.character() -> Sequence.mm10
annotatedPeak.mm10$Sequence.mm10 = Sequence.mm10
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist() %>% subset(width==28)
annotatedPeak.mm10 %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .) %>%
as.character() -> Sequence.mm10
annotatedPeak.mm10$Sequence.mm10 = Sequence.mm10
annotatedPeak.mm10
?BSgenome::getSeq()
??BSgenome::getSeq()
??getSeq
TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.mm10, Model_Sample1)
annotatedPeak.mm10$Predicted.Energy.mm10 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.mm10, Model_Sample1)
annotatedPeak %>%
BSgenome::getSeq(BSgenome.Hsapiens.UCSC.hg38,
names = .) -> Sequence.hg38
annotatedPeak$Sequence.hg38 = Sequence.hg38
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist() %>% subset(width==28)
annotatedPeak.mm10 %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .,
) %>%
as.character() -> Sequence.mm10
annotatedPeak.mm10$Sequence.mm10 = Sequence.mm10
annotatedPeak.mm10$Predicted.Energy.mm10 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.mm10, Model_Sample1)
annotatedPeak.mm10
annotatedPeak.mm10$Predicted.Energy.hg38 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.hg38, Model_Sample1)
annotatedPeak.mm10$Sequence.hg38
annotatedPeak %>%
BSgenome::getSeq(BSgenome.Hsapiens.UCSC.hg38,
names = .) %>%
as.character() -> Sequence.hg38
annotatedPeak$Sequence.hg38 = Sequence.hg38
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist() %>% subset(width==28)
annotatedPeak.mm10 %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .,
) %>%
as.character() -> Sequence.mm10
annotatedPeak.mm10$Sequence.mm10 = Sequence.mm10
annotatedPeak.mm10$Sequence.hg38
annotatedPeak.mm10$Predicted.Energy.mm10 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.mm10, Model_Sample1)
annotatedPeak.mm10$Predicted.Energy.hg38 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.hg38, Model_Sample1)
annotatedPeak.mm10
annotatedPeak.mm10 %>% as_tibble()
annotatedPeak.mm10 %>% as_tibble() %>%
ggplot(aes(x = Predicted.Energy.hg38,
y = Predicted.Energy.mm10)) +
geom_point()
annotatedPeak.mm10 %>%
subset(Predicted.Energy.hg38 < -3.5,
Predicted.Energy.mm10 < 0)
annotatedPeak.mm10 %>%
subset(Predicted.Energy.hg38 < -3.5,
Predicted.Energy.mm10 < 0) %>% as_tibble()
annotatedPeak.mm10 %>% as_tibble() %>%
subset(Predicted.Energy.hg38 < -3.5,
Predicted.Energy.mm10 < 0)
annotatedPeak.mm10 %>% as_tibble() %>%
filter(Predicted.Energy.hg38 < -3.5,
Predicted.Energy.mm10 < 0)
annotatedPeak.mm10 %>% as_tibble() %>%
dplyr::filter(Predicted.Energy.hg38 < -3.5,
Predicted.Energy.mm10 < 0)
annotatedPeak.mm10 %>% as_tibble() %>%
dplyr::filter(gene_name == "MARK1")
ChIP.peaks <- read.table("./GSE91521_ENCFF348HKK_optimal_idr_thresholded_peaks_GRCh38.bed")
ChIP.peaks.GRanges <- GenomicRanges::GRanges(seqnames = ChIP.peaks$V1,
ranges   = IRanges(start = ChIP.peaks$V2, end = ChIP.peaks$V3))
ZFP3.PEM <- Model_Sample1 %>%
TFCookbook::getEnergyMatrix()
ZFP3.sites <- (motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = ChIP.peaks.GRanges,
genome = "hg38",
out = "positions",
p.cutoff = 1e-5))[[1]]
require(ChIPpeakAnno)
require(EnsDb.Hsapiens.v86) ##(hg19)
## create annotation file from EnsDb or TxDb
annoData <- toGRanges(EnsDb.Hsapiens.v86, feature="gene")
annotatedPeak <- annotatePeakInBatch(ZFP3.sites,
AnnotationData = annoData)
annotatedPeak$gene_name <- annoData$gene_name[match(annotatedPeak$feature,
names(annoData))]
annotatedPeak %>% as.data.frame()
arrange(desc(score))
annotatedPeak %>% as.data.frame()
annotatedPeak %>%
BSgenome::getSeq(BSgenome.Hsapiens.UCSC.hg38,
names = .) %>%
as.character() -> Sequence.hg38
annotatedPeak$Sequence.hg38 = Sequence.hg38
annotatedPeak$Sequence.hg38 = Sequence.hg38
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist() %>% subset(width==28)
annotatedPeak.mm10 %>%
BSgenome::getSeq(BSgenome.Mmusculus.UCSC.mm10,
names = .,
) %>%
as.character() -> Sequence.mm10
annotatedPeak.mm10$Sequence.mm10 = Sequence.mm10
annotatedPeak.mm10$Predicted.Energy.mm10 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.mm10, Model_Sample1)
annotatedPeak.mm10$Predicted.Energy.hg38 = TFCookbook::predictEnergy(annotatedPeak.mm10$Sequence.hg38, Model_Sample1)
annotatedPeak.mm10 %>% as_tibble() %>%
ggplot(aes(x = Predicted.Energy.hg38,
y = Predicted.Energy.mm10)) +
geom_point()
annotatedPeak.mm10 %>% as_tibble() %>%
ggplot(aes(x = Predicted.Energy.hg38,
y = Predicted.Energy.mm10)) +
geom_point()
annotatedPeak.mm10 %>% as_tibble()
annotatedPeak.mm10 %>% as_tibble() %>%
ggplot(aes(x = Predicted.Energy.hg38,
y = Predicted.Energy.mm10)) +
geom_point()
annotatedPeak.mm10 %>% as_tibble() %>%
dplyr::filter(gene_name == "MARK1")
arrange(desc(score)) %>%
dplyr::filter(gene_name == "MARK1")
annotatedPeak %>% as.data.frame() %>%
arrange(desc(score)) %>%
dplyr::filter(gene_name == "MARK1")
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist()
annotatedPeak.mm10 %>% subset(gene_name == "MARK1")
ZFP3.sites <- (motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = Lung.CREs.GRanges,
genome = "hg38",
out = "positions",
p.cutoff = 1e-5))[[1]]
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>% unlist() %>% subset(width >= 20)
annotatedPeak.mm10 %>% subset(gene_name == "MARK1")
??flank
annotatedPeak.mm10 %>% IRanges::promoters(upstream = 10, downstream = 10)
annotatedPeak.mm10 %>% IRanges::promoters(upstream = 20, downstream = 10)
annotatedPeak.mm10 %>% IRanges::promoters(upstream = 20, downstream = 20)
annotatedPeak.mm10
annotatedPeak.mm10 %>% IRanges::promoters(upstream = 20, downstream = 20)
annotatedPeak.mm10 %>% IRanges::promoters(upstream = 20, downstream = 30)
annotatedPeak.mm10 %>% IRanges::promoters(upstream = 10, downstream = 30)
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>%
unlist() %>% subset(width >= 20) %>%
IRanges::promoters(upstream = 10, downstream = 30)
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
(motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = annotatedPeak.mm10,
genome = "mm10",
out = "scores",
p.cutoff = 1e-5))
(motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = annotatedPeak.mm10,
genome = "mm10",
out = "positions",
p.cutoff = 1e-5))
ZFP3.sites <- (motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = Lung.CREs.GRanges,
genome = "hg38",
out = "positions",
p.cutoff = 1e-5))[[1]]
ZFP3.sites
## create annotation file from EnsDb or TxDb
annoData <- toGRanges(EnsDb.Hsapiens.v86, feature="gene")
annotatedPeak <- annotatePeakInBatch(ZFP3.sites,
AnnotationData = annoData)
annotatedPeak %>% as.data.frame() %>%
arrange(desc(score)) %>%
dplyr::filter(gene_name == "MARK1")
annotatedPeak
annotatedPeak.mm10 <- rtracklayer::liftOver(annotatedPeak, chain = chain) %>%
unlist() %>% subset(width >= 20) %>%
IRanges::promoters(upstream = 10, downstream = 30)
(motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = annotatedPeak.mm10,
genome = "mm10",
out = "positions",
p.cutoff = 1e-5))
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
(motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = annotatedPeak.mm10,
genome = "mm10",
out = "positions",
p.cutoff = 1e-5))[[1]]
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
(motifmatchr::matchMotifs(
pwms = TFCookbook::toPFM(ZFP3.PEM, miu = -2) %>%
TFBSTools::PFMatrix(profileMatrix = .) %>%
TFBSTools::toPWM(),
subject = annotatedPeak.mm10,
genome = "mm10",
out = "positions",
p.cutoff = 1e-5))[[1]] %>%
subset(score>20)
